<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:c="clr-namespace:BetterWidgets.Controls"
    xmlns:converters="clr-namespace:BetterWidgets.Behaviours.Converters"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:vm="clr-namespace:BetterWidgets.ViewModel.Components">

    <converters:BoolToVisibility x:Key="BoolToVisibilityInvertForWidgetTemplates" IsInvert="True" />

    <Style x:Key="SettingsCollectionStyle" TargetType="ListView">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}" />
        <Setter Property="BorderBrush" Value="Transparent" />
        <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled" />
        <Setter Property="BorderThickness" Value="0" />
        <Setter Property="ItemContainerStyle">
            <Setter.Value>
                <Style TargetType="{x:Type ListViewItem}">
                    <Setter Property="Margin" Value="30,0,30,10" />
                    <Setter Property="Background" Value="Transparent" />
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="{x:Type ListViewItem}">
                                <ContentPresenter DataContext="{TemplateBinding DataContext}" ScrollViewer.CanContentScroll="False" />
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </Setter.Value>
        </Setter>
    </Style>

    <Style
        x:Key="DefaultSettingCategory"
        BasedOn="{StaticResource DefaultPageStyle}"
        TargetType="c:SettingCategory">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="c:SettingCategory">
                    <Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <Grid
                            Grid.Row="0"
                            Margin="30,32,30,20"
                            HorizontalAlignment="Stretch">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <ui:Button
                                Grid.Column="0"
                                Width="32"
                                Height="32"
                                Padding="0"
                                Background="Transparent"
                                BorderBrush="Transparent"
                                Command="{TemplateBinding BackCommand}">
                                <ui:SymbolIcon Symbol="ArrowLeft20" />
                            </ui:Button>
                            <TextBlock
                                Grid.Column="1"
                                Margin="10,0,0,1"
                                VerticalAlignment="Center"
                                FontSize="20"
                                FontWeight="SemiBold"
                                Text="{TemplateBinding Title}" />
                        </Grid>
                        <Grid Grid.Row="1">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <ContentPresenter Grid.Row="0" Content="{TemplateBinding Content}" />
                            <ListView
                                Name="UISettingsCollection"
                                Grid.Row="1"
                                ItemsSource="{TemplateBinding Settings}"
                                Style="{StaticResource SettingsCollectionStyle}" />
                        </Grid>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>

        <Setter Property="RenderTransformOrigin" Value="0.5,0.5" />
        <Setter Property="RenderTransform">
            <Setter.Value>
                <TransformGroup>
                    <TranslateTransform />
                </TransformGroup>
            </Setter.Value>
        </Setter>

        <Style.Triggers>
            <EventTrigger RoutedEvent="Loaded">
                <BeginStoryboard>
                    <Storyboard>
                        <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="RenderTransform.(TransformGroup.Children)[0].(TranslateTransform.Y)">
                            <EasingDoubleKeyFrame KeyTime="00:00:00" Value="-60" />
                            <EasingDoubleKeyFrame KeyTime="00:00:00.2000000" Value="0">
                                <EasingDoubleKeyFrame.EasingFunction>
                                    <ExponentialEase EasingMode="EaseOut" />
                                </EasingDoubleKeyFrame.EasingFunction>
                            </EasingDoubleKeyFrame>
                        </DoubleAnimationUsingKeyFrames>
                        <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="Opacity">
                            <EasingDoubleKeyFrame KeyTime="00:00:00" Value="0" />
                            <EasingDoubleKeyFrame KeyTime="00:00:00.2000000" Value="1">
                                <EasingDoubleKeyFrame.EasingFunction>
                                    <ExponentialEase EasingMode="EaseOut" />
                                </EasingDoubleKeyFrame.EasingFunction>
                            </EasingDoubleKeyFrame>
                        </DoubleAnimationUsingKeyFrames>
                    </Storyboard>
                </BeginStoryboard>
            </EventTrigger>
        </Style.Triggers>
    </Style>

    <Style
        x:Key="DefaultSettingPage"
        BasedOn="{StaticResource DefaultPageStyle}"
        TargetType="c:SettingsPage">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="c:SettingsPage">
                    <Grid
                        Margin="0,32,0,0"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        DataContext="{TemplateBinding DataContext}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <Grid
                            Grid.Row="0"
                            Margin="30,0,30,20"
                            HorizontalAlignment="Stretch">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <ui:Button
                                Grid.Column="0"
                                Width="32"
                                Height="32"
                                Padding="0"
                                Background="Transparent"
                                BorderBrush="Transparent"
                                Command="{TemplateBinding BackCommand}">
                                <ui:SymbolIcon Symbol="ArrowLeft20" />
                            </ui:Button>
                            <TextBlock
                                Grid.Column="1"
                                Margin="10,0,0,1"
                                VerticalAlignment="Center"
                                FontSize="20"
                                FontWeight="SemiBold"
                                Text="{TemplateBinding Title}" />
                        </Grid>
                        <ItemsControl
                            Name="UIMessagesCollectionView"
                            Grid.Row="1"
                            Margin="30,0,30,10"
                            ItemsSource="{TemplateBinding Messages}" />
                        <ContentPresenter Grid.Row="2" Content="{TemplateBinding Content}" />
                        <ListView
                            Name="UISettingsCollection"
                            Grid.Row="3"
                            ItemsSource="{TemplateBinding Settings}"
                            Style="{StaticResource SettingsCollectionStyle}" />
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="RenderTransformOrigin" Value="0.5,0.5" />
        <Setter Property="RenderTransform">
            <Setter.Value>
                <TransformGroup>
                    <TranslateTransform />
                </TransformGroup>
            </Setter.Value>
        </Setter>

        <Style.Triggers>
            <EventTrigger RoutedEvent="Loaded">
                <BeginStoryboard>
                    <Storyboard>
                        <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="RenderTransform.(TransformGroup.Children)[0].(TranslateTransform.Y)">
                            <EasingDoubleKeyFrame KeyTime="00:00:00" Value="-60" />
                            <EasingDoubleKeyFrame KeyTime="00:00:00.2000000" Value="0">
                                <EasingDoubleKeyFrame.EasingFunction>
                                    <ExponentialEase EasingMode="EaseOut" />
                                </EasingDoubleKeyFrame.EasingFunction>
                            </EasingDoubleKeyFrame>
                        </DoubleAnimationUsingKeyFrames>
                        <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="Opacity">
                            <EasingDoubleKeyFrame KeyTime="00:00:00" Value="0" />
                            <EasingDoubleKeyFrame KeyTime="00:00:00.2000000" Value="1">
                                <EasingDoubleKeyFrame.EasingFunction>
                                    <ExponentialEase EasingMode="EaseOut" />
                                </EasingDoubleKeyFrame.EasingFunction>
                            </EasingDoubleKeyFrame>
                        </DoubleAnimationUsingKeyFrames>
                    </Storyboard>
                </BeginStoryboard>
            </EventTrigger>
        </Style.Triggers>
    </Style>

    <DataTemplate x:Key="WidgetTrayViewItemTemplate" DataType="vm:WidgetViewItem">
        <Grid Margin="6" IsEnabled="{Binding IsEnabled, Mode=OneWay}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <Image
                Grid.Column="0"
                Width="20"
                Height="20"
                Source="{Binding IconSource, Mode=OneWay}" />

            <TextBlock
                Grid.Column="1"
                Margin="10,0"
                VerticalAlignment="Center"
                Text="{Binding Title, Mode=OneWay}"
                TextTrimming="CharacterEllipsis" />

            <ui:ProgressRing
                Grid.Column="2"
                Width="18"
                Height="18"
                Margin="0,0,10,0"
                IsIndeterminate="True"
                Visibility="{Binding IsEnabled, Mode=OneWay, Converter={StaticResource BoolToVisibilityInvertForWidgetTemplates}}" />

            <ui:Button
                Grid.ColumnSpan="4"
                Margin="-10"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Background="Transparent"
                BorderBrush="Transparent"
                Command="{Binding ActivateCommand}" />

            <ui:ToggleSwitch
                Grid.Column="3"
                VerticalAlignment="Center"
                Panel.ZIndex="1"
                IsChecked="{Binding IsPinned, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

        </Grid>
    </DataTemplate>

    <Style BasedOn="{StaticResource DefaultSettingPage}" TargetType="c:SettingsPage" />
    <Style BasedOn="{StaticResource DefaultSettingCategory}" TargetType="c:SettingCategory" />

</ResourceDictionary>