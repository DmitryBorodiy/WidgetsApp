<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:b="clr-namespace:BetterWidgets.Behaviours.Converters"
    xmlns:c="clr-namespace:BetterWidgets.Controls"
    xmlns:r="clr-namespace:BetterWidgets.Resources"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml">

    <b:BoolToVisibility x:Key="WidgetTitleBarVisibilityConverter" />
    <b:BoolToVisibility x:Key="WidgetTitleBarVisibilityConverterInvert" IsInvert="True" />

    <Style
        x:Key="DefaultWidgetTitleBarCommandStyle"
        BasedOn="{StaticResource {x:Type ui:Button}}"
        TargetType="ui:Button">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="BorderBrush" Value="Transparent" />
        <Setter Property="Padding" Value="7" />
    </Style>

    <Style
        x:Key="DefaultWidgetTitleBarToggleCommandStyle"
        BasedOn="{StaticResource DefaultToggleButtonStyle}"
        TargetType="ToggleButton">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="BorderBrush" Value="Transparent" />
        <Setter Property="Padding" Value="7" />
    </Style>

    <Style x:Key="DefaultWidgetTitleBarStyle" TargetType="c:WidgetTitleBar">
        <Setter Property="CanPin" Value="True" />
        <Setter Property="CanClose" Value="True" />
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="Padding" Value="3,0" />

        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="c:WidgetTitleBar">
                    <Border Padding="{TemplateBinding Padding}">
                        <Grid MinHeight="35" Background="{TemplateBinding Background}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Image
                                Grid.Column="0"
                                Width="19"
                                Height="19"
                                Margin="10,1,10,0"
                                VerticalAlignment="Center"
                                Source="{TemplateBinding Icon}"
                                Visibility="{TemplateBinding IconVisibility}" />
                            <ui:TextBlock
                                Grid.Column="1"
                                Margin="0,5,0,0"
                                VerticalAlignment="Center"
                                FontSize="12"
                                Text="{TemplateBinding Title}"
                                TextTrimming="CharacterEllipsis"
                                Visibility="{TemplateBinding TitleVisibility}" />

                            <ContentPresenter Grid.Column="2" Content="{TemplateBinding Content}" />

                            <Grid Grid.Column="3">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <ToggleButton
                                    x:Name="UIPinCommand"
                                    Grid.Column="0"
                                    VerticalAlignment="Center"
                                    IsChecked="{TemplateBinding IsPinned}"
                                    Style="{StaticResource DefaultWidgetTitleBarToggleCommandStyle}"
                                    ToolTipService.ToolTip="{x:Static r:Resources.PinLabel}"
                                    Visibility="{TemplateBinding CanPin,
                                                                 Converter={StaticResource WidgetTitleBarVisibilityConverter}}">
                                    <ToggleButton.Content>
                                        <Grid>
                                            <ui:SymbolIcon
                                                FontSize="15"
                                                Symbol="Pin20"
                                                Visibility="{TemplateBinding IsPinned,
                                                                             Converter={StaticResource WidgetTitleBarVisibilityConverterInvert}}" />
                                            <ui:SymbolIcon
                                                FontSize="15"
                                                Symbol="PinOff20"
                                                Visibility="{TemplateBinding IsPinned,
                                                                             Converter={StaticResource WidgetTitleBarVisibilityConverter}}" />
                                        </Grid>
                                    </ToggleButton.Content>
                                </ToggleButton>
                                <ui:Button
                                    x:Name="UICloseCommand"
                                    Grid.Column="1"
                                    VerticalAlignment="Center"
                                    Command="{TemplateBinding CloseCommand}"
                                    CommandParameter="{TemplateBinding CloseCommandParameter}"
                                    MouseOverBackground="{DynamicResource PaletteRedBrush}"
                                    Style="{StaticResource DefaultWidgetTitleBarCommandStyle}"
                                    ToolTipService.ToolTip="{x:Static r:Resources.CloseLabel}"
                                    Visibility="{TemplateBinding CanClose,
                                                                 Converter={StaticResource WidgetTitleBarVisibilityConverter}}">
                                    <ui:Button.Icon>
                                        <ui:SymbolIcon FontSize="15" Symbol="Dismiss20" />
                                    </ui:Button.Icon>
                                </ui:Button>
                            </Grid>
                        </Grid>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style BasedOn="{StaticResource DefaultWidgetTitleBarStyle}" TargetType="c:WidgetTitleBar" />

</ResourceDictionary>