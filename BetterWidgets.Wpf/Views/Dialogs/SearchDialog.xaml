<Page
    x:Class="BetterWidgets.Views.Dialogs.SearchDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:BetterWidgets.Views.Dialogs"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:r="clr-namespace:BetterWidgets.Resources"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:validators="clr-namespace:BetterWidgets.Behaviours.Validators"
    x:Name="Root"
    d:Background="{ui:ThemeResource ApplicationBackgroundBrush}"
    d:DesignHeight="280"
    d:DesignWidth="280"
    d:Foreground="{ui:ThemeResource TextFillColorPrimaryBrush}"
    mc:Ignorable="d">

    <Grid
        x:Name="RootLayout"
        MinWidth="250"
        MinHeight="180"
        MaxWidth="300"
        MaxHeight="300"
        Margin="0,5,0,0"
        d:Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
        </Grid.RowDefinitions>

        <ui:TextBox
            x:Name="UISearchBox"
            Grid.Row="0"
            VerticalAlignment="Top"
            PlaceholderText="{x:Static r:Resources.PlaceSearchPlaceholder}"
            RenderTransformOrigin="0.5,0.5">
            <ui:TextBox.Text>
                <Binding
                    Mode="TwoWay"
                    NotifyOnValidationError="True"
                    Path="SearchText"
                    UpdateSourceTrigger="PropertyChanged" />
            </ui:TextBox.Text>
            <ui:TextBox.Icon>
                <ui:SymbolIcon Symbol="Search20" />
            </ui:TextBox.Icon>
            <ui:TextBox.RenderTransform>
                <ScaleTransform ScaleX="1" ScaleY="1" />
            </ui:TextBox.RenderTransform>
            <ui:TextBox.Style>
                <Style BasedOn="{StaticResource {x:Type ui:TextBox}}" TargetType="ui:TextBox">
                    <Setter Property="Validation.ErrorTemplate">
                        <Setter.Value>
                            <ControlTemplate>
                                <StackPanel HorizontalAlignment="Stretch">
                                    <AdornedElementPlaceholder x:Name="adorner" />
                                    <ItemsControl
                                        Width="{Binding ActualWidth, ElementName=adorner, Mode=OneWay}"
                                        Margin="0,3,0,0"
                                        HorizontalAlignment="Stretch"
                                        ItemsSource="{Binding}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <ui:InfoBar
                                                    Title="{Binding ErrorContent}"
                                                    Margin="0,0,0,5"
                                                    HorizontalAlignment="Stretch"
                                                    IsClosable="False"
                                                    IsOpen="True"
                                                    Severity="Warning" />
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </ui:TextBox.Style>
        </ui:TextBox>

        <ui:ListView
            Grid.Row="1"
            Margin="0,9,0,0"
            ItemTemplate="{Binding SuggestionItemTemplate}"
            ItemsSource="{Binding Suggestions, Mode=OneWay}"
            SelectedItem="{Binding SelectedSuggestion, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
    </Grid>
</Page>
