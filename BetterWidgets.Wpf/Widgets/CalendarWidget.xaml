<c:Widget
    x:Class="BetterWidgets.Widgets.CalendarWidget"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:c="clr-namespace:BetterWidgets.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:r="clr-namespace:BetterWidgets.Resources"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:vm="clr-namespace:BetterWidgets.ViewModel.Widgets"
    x:Name="Root"
    Width="260"
    Height="255"
    MinWidth="100"
    MinHeight="100"
    AppearedCommand="{Binding AppearedCommand}"
    AppearedCommandParameter="{Binding ElementName=Root}"
    CanShare="{Binding IsAppointmentSelected, Mode=OneWay}"
    IsHideTitleBar="True"
    IsTitleBarEnabled="{Binding IsTitleBarEnabled, Mode=OneWay}"
    PinnedCommand="{Binding PinnedCommand}"
    PinnedCommandParameter="{Binding ElementName=Root}"
    ShareCommand="{Binding ShareCommand}"
    SizeChangedCommand="{Binding SizeChangedCommand}"
    UnpinCommand="{Binding UnpinCommand}"
    UnpinCommandParameter="{Binding ElementName=Root}"
    mc:Ignorable="d">
    <c:Widget.TitleBar>
        <c:WidgetTitleBar IsPinned="{Binding ElementName=Root, Path=Topmost, Mode=TwoWay}" />
    </c:Widget.TitleBar>
    <c:Widget.DataContext>
        <vm:CalendarWidgetViewModel />
    </c:Widget.DataContext>
    <c:Widget.Resources>
        <ResourceDictionary>
            <Style x:Key="RootLayoutStyle" TargetType="Grid">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="Margin" Value="14,12,13,12" />
            </Style>

            <Style x:Key="DefaultUICommandBar" TargetType="StackPanel">
                <Setter Property="Margin" Value="-2,8,3,1" />
                <Setter Property="HorizontalAlignment" Value="Left" />
                <Setter Property="VerticalAlignment" Value="Top" />
            </Style>

            <Style x:Key="DefaultDateViewUI" TargetType="Viewbox">
                <Setter Property="Grid.Row" Value="0" />
                <Setter Property="Grid.Column" Value="0" />
                <Setter Property="HorizontalAlignment" Value="Left" />
                <Setter Property="VerticalAlignment" Value="Top" />
                <Setter Property="TextBlock.TextAlignment" Value="Left" />
            </Style>

            <Style x:Key="DefaultDayPickerUI" TargetType="Grid">
                <Setter Property="Grid.Column" Value="1" />
                <Setter Property="Margin" Value="0,-2,-11,0" />
            </Style>

            <Style
                x:Key="DefaultAppointmentsCollectionUI"
                BasedOn="{StaticResource {x:Type ui:ListView}}"
                TargetType="ui:ListView">
                <Setter Property="Margin" Value="0" />
                <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled" />

                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Visible" />
                    </Trigger>
                    <Trigger Property="IsMouseOver" Value="False">
                        <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Hidden" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="DefaultAppointmentsContainerUI" TargetType="Border">
                <Setter Property="Grid.Row" Value="1" />
                <Setter Property="Grid.ColumnSpan" Value="2" />
            </Style>

            <Style x:Key="DefaultMonthPickerUI" TargetType="Grid">
                <Setter Property="Grid.ColumnSpan" Value="2" />
                <Setter Property="Grid.RowSpan" Value="2" />
                <Setter Property="Background" Value="Transparent" />
            </Style>
        </ResourceDictionary>
    </c:Widget.Resources>
    <c:Widget.ContextMenu>
        <ContextMenu>
            <ui:MenuItem Command="{Binding RefreshCommand}" Header="{x:Static r:Resources.Refresh}">
                <ui:MenuItem.Icon>
                    <ui:SymbolIcon Symbol="ArrowClockwise20" />
                </ui:MenuItem.Icon>
            </ui:MenuItem>
            <ui:MenuItem
                Command="{Binding ShareCommand}"
                Header="{x:Static r:Resources.ShareLabel}"
                Visibility="{Binding IsAppointmentSelected, Mode=OneWay, Converter={StaticResource BoolToVisibility}}">
                <ui:MenuItem.Icon>
                    <ui:SymbolIcon Symbol="Share20" />
                </ui:MenuItem.Icon>
            </ui:MenuItem>
            <Separator />
            <ui:MenuItem Command="{Binding LaunchSettingsCommand}" Header="{x:Static r:Resources.SettingsLabel}">
                <ui:MenuItem.Icon>
                    <ui:SymbolIcon Symbol="Settings20" />
                </ui:MenuItem.Icon>
            </ui:MenuItem>
        </ContextMenu>
    </c:Widget.ContextMenu>

    <Grid
        x:Name="RootLayout"
        d:Margin="10,7"
        Style="{StaticResource RootLayoutStyle}">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <Viewbox
            MaxWidth="48"
            MaxHeight="120"
            Style="{StaticResource DefaultDateViewUI}"
            Visibility="{Binding RootVisibility, Mode=OneWay}">
            <Viewbox.Resources>
                <ResourceDictionary>
                    <Style
                        x:Key="Default"
                        BasedOn="{StaticResource DefaultDateViewUI}"
                        TargetType="Viewbox" />
                    <Style
                        x:Key="Medium"
                        BasedOn="{StaticResource DefaultDateViewUI}"
                        TargetType="Viewbox" />
                    <Style
                        x:Key="Large"
                        BasedOn="{StaticResource DefaultDateViewUI}"
                        TargetType="Viewbox" />
                    <Style
                        x:Key="Small"
                        BasedOn="{StaticResource DefaultDateViewUI}"
                        TargetType="Viewbox">
                        <Setter Property="Grid.RowSpan" Value="2" />
                        <Setter Property="Grid.ColumnSpan" Value="2" />
                        <Setter Property="Margin" Value="-3,-8,0,0" />
                        <Setter Property="TextBlock.TextAlignment" Value="Center" />
                        <Setter Property="HorizontalAlignment" Value="Center" />
                        <Setter Property="VerticalAlignment" Value="Center" />
                    </Style>
                </ResourceDictionary>
            </Viewbox.Resources>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <ui:Button
                    Grid.Row="0"
                    HorizontalContentAlignment="Stretch"
                    Command="{Binding ShowCalendarDialogCommand}"
                    IsHitTestVisible="{Binding IsClickable, Mode=OneWay}"
                    Style="{StaticResource FlatButton}">
                    <StackPanel HorizontalAlignment="Stretch">
                        <ui:TextBlock
                            Margin="0,0,0,-2"
                            Padding="0"
                            d:Text="Sunday"
                            FontSize="12"
                            Opacity="0.8"
                            Text="{Binding SelectedDate.DateTime.DayOfWeek, Mode=OneWay}"
                            TextTrimming="CharacterEllipsis" />
                        <ui:TextBlock
                            Margin="0,-5,0,0"
                            Padding="0"
                            d:Text="August"
                            FontSize="17"
                            FontWeight="SemiBold"
                            Foreground="{DynamicResource AccentButtonBackground}"
                            Text="{Binding SelectedDate.MonthName, Mode=OneWay}"
                            TextTrimming="CharacterEllipsis" />
                        <ui:TextBlock
                            Margin="0,-13,0,-11"
                            Padding="0"
                            d:Text="16"
                            FontSize="55"
                            FontWeight="Light"
                            Text="{Binding SelectedDate.DateTime.Day, Mode=OneWay}" />
                    </StackPanel>
                </ui:Button>

                <StackPanel
                    x:Name="UICommandBar"
                    Grid.Row="1"
                    Style="{StaticResource DefaultUICommandBar}"
                    Visibility="{Binding IsClickable, Mode=OneWay, Converter={StaticResource BoolToVisibility}}">
                    <ui:Button
                        Command="{Binding CreateAppointmentCommand}"
                        IsEnabled="{Binding CanManipulateEvents, Mode=OneWay}"
                        Style="{StaticResource DefaultWidgetTitleBarCommandStyle}"
                        ToolTipService.ToolTip="{x:Static r:Resources.CreateEvent}">
                        <ui:Button.Icon>
                            <ui:SymbolIcon FontSize="16" Symbol="Add20" />
                        </ui:Button.Icon>
                    </ui:Button>
                    <!--<ui:Button
                        Command="{Binding ShowCalendarPickerCommand}"
                        IsEnabled="{Binding CanManipulateEvents, Mode=OneWay}"
                        Style="{StaticResource DefaultWidgetTitleBarCommandStyle}"
                        ToolTipService.ToolTip="{x:Static r:Resources.SelectCalendar}">
                        <ui:Button.Icon>
                            <ui:SymbolIcon FontSize="16" Symbol="CalendarEdit20" />
                        </ui:Button.Icon>
                    </ui:Button>-->
                </StackPanel>
            </Grid>
        </Viewbox>

        <Grid Style="{StaticResource DefaultDayPickerUI}">
            <Grid.Resources>
                <ResourceDictionary>
                    <Style
                        x:Key="Default"
                        BasedOn="{StaticResource DefaultDayPickerUI}"
                        TargetType="Grid">
                        <Setter Property="Visibility" Value="{Binding RootVisibility, Mode=OneWay}" />
                    </Style>
                    <Style
                        x:Key="Medium"
                        BasedOn="{StaticResource DefaultDayPickerUI}"
                        TargetType="Grid">
                        <Setter Property="Visibility" Value="{Binding RootVisibility, Mode=OneWay}" />
                    </Style>
                    <Style
                        x:Key="Large"
                        BasedOn="{StaticResource DefaultDayPickerUI}"
                        TargetType="Grid">
                        <Setter Property="Visibility" Value="{Binding RootVisibility, Mode=OneWay}" />
                    </Style>
                    <Style
                        x:Key="Small"
                        BasedOn="{StaticResource DefaultDayPickerUI}"
                        TargetType="Grid">
                        <Setter Property="Visibility" Value="Collapsed" />
                    </Style>
                </ResourceDictionary>
            </Grid.Resources>
            <c:DayPicker
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                HorizontalFlipButtonsVisibility="Visible"
                SelectedDate="{Binding SelectedDateTime, Mode=TwoWay}" />
        </Grid>

        <Border d:IsHidden="True" Style="{StaticResource DefaultAppointmentsContainerUI}">
            <Border.Resources>
                <ResourceDictionary>
                    <Style
                        x:Key="Default"
                        BasedOn="{StaticResource DefaultAppointmentsContainerUI}"
                        TargetType="Border">
                        <Setter Property="Visibility" Value="{Binding RootVisibility, Mode=OneWay}" />
                    </Style>
                    <Style
                        x:Key="Medium"
                        BasedOn="{StaticResource DefaultAppointmentsContainerUI}"
                        TargetType="Border">
                        <Setter Property="Visibility" Value="{Binding RootVisibility, Mode=OneWay}" />
                    </Style>

                    <Style
                        x:Key="Small"
                        BasedOn="{StaticResource DefaultAppointmentsContainerUI}"
                        TargetType="Border">
                        <Setter Property="Visibility" Value="Collapsed" />
                    </Style>
                </ResourceDictionary>
            </Border.Resources>

            <Viewbox MaxHeight="150">
                <ui:ListView
                    Width="255"
                    MaxHeight="150"
                    Margin="-1,10,1,0"
                    VerticalAlignment="Bottom"
                    ItemTemplate="{StaticResource AppointmentItemTemplate}"
                    ItemsSource="{Binding AppointmentViews, Mode=OneWay}"
                    MouseDoubleClick="OnAppointmentsMouseDoubleClick"
                    SelectedItem="{Binding SelectedAppointment, Mode=TwoWay}"
                    Style="{StaticResource DefaultAppointmentsCollectionUI}"
                    Visibility="{Binding HasAppointments, Mode=OneWay, Converter={StaticResource BoolToVisibility}}">
                    <ui:ListView.ContextMenu>
                        <ContextMenu>
                            <ui:MenuItem Command="{Binding ViewAppointmentCommand}" Header="{x:Static r:Resources.View}">
                                <ui:MenuItem.Icon>
                                    <ui:SymbolIcon Symbol="Open20" />
                                </ui:MenuItem.Icon>
                            </ui:MenuItem>
                            <Separator />
                            <ui:MenuItem Command="{Binding RequestAppointmentUpdateCommand}" Header="{x:Static r:Resources.Edit}">
                                <ui:MenuItem.Icon>
                                    <ui:SymbolIcon Symbol="Edit20" />
                                </ui:MenuItem.Icon>
                            </ui:MenuItem>
                            <ui:MenuItem
                                Command="{Binding ShareCommand}"
                                Header="{x:Static r:Resources.ShareLabel}"
                                Visibility="{Binding IsAppointmentSelected, Mode=OneWay, Converter={StaticResource BoolToVisibility}}">
                                <ui:MenuItem.Icon>
                                    <ui:SymbolIcon Symbol="Share20" />
                                </ui:MenuItem.Icon>
                            </ui:MenuItem>
                            <ui:MenuItem Command="{Binding RequestDeleteAppointmentCommand}" Header="{x:Static r:Resources.DeleteLabel}">
                                <ui:MenuItem.Icon>
                                    <ui:SymbolIcon Symbol="Delete20" />
                                </ui:MenuItem.Icon>
                            </ui:MenuItem>
                        </ContextMenu>
                    </ui:ListView.ContextMenu>
                </ui:ListView>
            </Viewbox>
        </Border>

        <!--<Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <Calendar
                Margin="-2"
                FirstDayOfWeek="{Binding DayOfWeek, Mode=OneWay}"
                SelectedDate="{Binding SelectedDateTime, Mode=TwoWay}"
                Style="{StaticResource CompactCalendarStyle}" />

            <Grid
                Grid.Row="1"
                Grid.ColumnSpan="2"
                Margin="0,5,0,0">
                <ui:Button
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    Command="{Binding SelectTodayCommand}"
                    Content="{x:Static r:Resources.TodayLabel}">
                    <ui:Button.Icon>
                        <ui:SymbolIcon Symbol="CalendarDay20" />
                    </ui:Button.Icon>
                </ui:Button>
            </Grid>
        </Grid>-->
    </Grid>

</c:Widget>
