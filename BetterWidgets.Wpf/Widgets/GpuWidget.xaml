<c:Widget
    x:Class="BetterWidgets.Widgets.GpuWidget"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:c="clr-namespace:BetterWidgets.Controls"
    xmlns:chart="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:h="clr-namespace:BetterWidgets.Helpers"
    xmlns:local="clr-namespace:BetterWidgets.Widgets"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:r="clr-namespace:BetterWidgets.Resources"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:viewModel="clr-namespace:BetterWidgets.ViewModel.Widgets"
    x:Name="Root"
    Title="{x:Static r:Resources.GpuWidget}"
    MinWidth="120"
    MinHeight="120"
    d:DesignHeight="250"
    d:DesignWidth="250"
    d:WindowStyle="None"
    AppearedCommand="{Binding LoadedCommand, Mode=OneWay}"
    AppearedCommandParameter="{Binding ElementName=Root, Mode=OneTime}"
    IsHideTitleBar="True"
    IsLoading="{Binding IsLoading, Mode=OneWay}"
    IsTitleBarEnabled="True"
    SizeChangedCommand="{Binding SizeChangedCommand, Mode=OneWay}"
    StateChangedCommand="{Binding StateChangedCommand, Mode=OneWay}"
    Topmost="{Binding ElementName=UITitleBar, Path=IsPinned, Mode=OneWay}"
    mc:Ignorable="d">
    <c:Widget.DataContext>
        <viewModel:GpuWidgetViewModel />
    </c:Widget.DataContext>
    <c:Widget.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/Charts.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <Style x:Key="DefaultMainInfoStyle" TargetType="Grid">
                <Setter Property="Panel.ZIndex" Value="1" />
                <Setter Property="Grid.Column" Value="0" />
                <Setter Property="Grid.Row" Value="0" />

                <Setter Property="Margin" Value="15,7,0,0" />
            </Style>

            <Style x:Key="DefaultCaptionStyle" TargetType="Grid">
                <Setter Property="Grid.Row" Value="0" />
                <Setter Property="Grid.Column" Value="1" />
                <Setter Property="Panel.ZIndex" Value="1" />

                <Setter Property="Margin" Value="3,13,16,0" />
            </Style>

            <Style x:Key="DefaultChartStyle" TargetType="chart:CartesianChart">
                <Setter Property="Grid.ColumnSpan" Value="2" />
                <Setter Property="Grid.RowSpan" Value="2" />
                <Setter Property="HorizontalAlignment" Value="Stretch" />
                <Setter Property="VerticalAlignment" Value="Stretch" />
                <Setter Property="Margin" Value="-40,0" />
                <Setter Property="TooltipPosition" Value="Hidden" />
                <Setter Property="LegendPosition" Value="Hidden" />

                <Setter Property="XAxes" Value="{StaticResource PerformanceWidgetsXAxis}" />
                <Setter Property="YAxes" Value="{StaticResource PerformanceWidgetsYAxis}" />
            </Style>

            <Style x:Key="DefaultRadialIndicatorStyle" TargetType="Grid">
                <Setter Property="Visibility" Value="Collapsed" />

                <Setter Property="Grid.RowSpan" Value="2" />
                <Setter Property="Grid.ColumnSpan" Value="2" />

                <Setter Property="VerticalAlignment" Value="Center" />
                <Setter Property="HorizontalAlignment" Value="Center" />
            </Style>
        </ResourceDictionary>
    </c:Widget.Resources>
    <c:Widget.TitleBar>
        <c:WidgetTitleBar
            x:Name="UITitleBar"
            Background="Transparent"
            IconVisibility="Collapsed"
            IsPinned="{Binding Root.IsPinned, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
            TitleVisibility="Collapsed" />
    </c:Widget.TitleBar>
    <c:Widget.ContextMenu>
        <ContextMenu>
            <ui:MenuItem Command="{Binding LaunchSettingsCommand}" Header="{x:Static r:Resources.SettingsLabel}">
                <ui:MenuItem.Icon>
                    <ui:SymbolIcon Symbol="Settings20" />
                </ui:MenuItem.Icon>
            </ui:MenuItem>
        </ContextMenu>
    </c:Widget.ContextMenu>

    <Grid x:Name="RootLayout">
        <Grid x:Name="UIMain" Visibility="{Binding IsMainUIVisible, Mode=OneWay, Converter={StaticResource BoolToVisibility}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" MaxWidth="200" />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>

            <ToolTipService.ToolTip>
                <ToolTip>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Text="{Binding SelectedGpuDevice.Name, Mode=OneWay}"
                            TextWrapping="Wrap" />

                        <WrapPanel
                            Grid.Row="1"
                            Margin="-11,6,-11,0"
                            h:MarginSetter.Margin="10, 2"
                            Orientation="Horizontal">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <ui:SymbolIcon
                                    Grid.Column="0"
                                    FontSize="22"
                                    Symbol="DeveloperBoard20" />
                                <TextBlock
                                    Grid.Column="1"
                                    Margin="6,1,0,0"
                                    Text="{Binding SelectedGpuDevice.UsedMemoryDisplay, Mode=OneWay}" />
                            </Grid>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <ui:SymbolIcon
                                    Grid.Column="0"
                                    FontSize="22"
                                    Symbol="Storage20" />
                                <TextBlock
                                    Grid.Column="1"
                                    Margin="8,3,0,0"
                                    Text="{Binding SelectedGpuDevice.TotalMemoryDisplay, Mode=OneWay}" />
                            </Grid>
                        </WrapPanel>
                    </Grid>
                </ToolTip>
            </ToolTipService.ToolTip>

            <Grid x:Name="UIMainInfo" Style="{StaticResource DefaultMainInfoStyle}">
                <Grid.RowDefinitions>
                    <RowDefinition />
                    <RowDefinition />
                </Grid.RowDefinitions>
                <Grid.Resources>
                    <ResourceDictionary>
                        <Style
                            x:Key="Default"
                            BasedOn="{StaticResource DefaultMainInfoStyle}"
                            TargetType="Grid" />
                        <Style
                            x:Key="Small"
                            BasedOn="{StaticResource DefaultMainInfoStyle}"
                            TargetType="Grid">
                            <Setter Property="Visibility" Value="Collapsed" />
                        </Style>
                        <Style
                            x:Key="Medium"
                            BasedOn="{StaticResource DefaultMainInfoStyle}"
                            TargetType="Grid" />
                    </ResourceDictionary>
                </Grid.Resources>

                <ui:TextBlock
                    x:Name="UILoadPercentageBox"
                    Margin="0,-3"
                    d:Text="50%"
                    FontSize="43"
                    FontWeight="SemiBold"
                    Text="{Binding SelectedGpuDevice.PercentageDisplay, Mode=OneWay}" />

                <WrapPanel
                    Grid.Row="1"
                    Margin="0,5,0,0"
                    Orientation="Horizontal">
                    <Grid x:Name="UIMemoryBox">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>

                        <ui:SymbolIcon
                            Grid.Column="0"
                            FontSize="22"
                            Symbol="DeveloperBoard20" />
                        <TextBlock
                            Grid.Column="1"
                            Margin="6,0,0,2"
                            VerticalAlignment="Center"
                            d:Text="640 MB"
                            FontSize="15"
                            Text="{Binding SelectedGpuDevice.UsedMemoryDisplay, Mode=OneWay}" />
                    </Grid>
                </WrapPanel>
            </Grid>

            <Grid x:Name="UICaption" Style="{StaticResource DefaultCaptionStyle}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Grid.Resources>
                    <ResourceDictionary>
                        <Style
                            x:Key="Default"
                            BasedOn="{StaticResource DefaultCaptionStyle}"
                            TargetType="Grid" />
                        <Style
                            x:Key="Small"
                            BasedOn="{StaticResource DefaultCaptionStyle}"
                            TargetType="Grid">
                            <Setter Property="Visibility" Value="Collapsed" />
                        </Style>
                        <Style
                            x:Key="Medium"
                            BasedOn="{StaticResource DefaultCaptionStyle}"
                            TargetType="Grid" />
                    </ResourceDictionary>
                </Grid.Resources>

                <ui:TextBlock
                    Grid.Row="0"
                    d:Text="Intel(R) UHD Graphics 620"
                    FontSize="17"
                    Text="{Binding SelectedGpuDevice.Name, Mode=OneWay}"
                    TextAlignment="Right"
                    TextTrimming="CharacterEllipsis" />
                <ui:TextBlock
                    Grid.Row="1"
                    d:Text="7 GB"
                    d:Visibility="Visible"
                    FontSize="15"
                    Text="{Binding SelectedGpuDevice.TotalMemoryDisplay, Mode=OneWay}"
                    TextAlignment="Right"
                    TextTrimming="CharacterEllipsis" />
            </Grid>

            <chart:CartesianChart
                x:Name="UIChart"
                AnimationsSpeed="{Binding AnimationSpeed, Mode=OneWay}"
                Opacity="{Binding ChartOpacity, Mode=OneWay}"
                Series="{Binding SelectedGpuDevice.Series.Series, Mode=OneWay}"
                Style="{StaticResource DefaultChartStyle}">
                <chart:CartesianChart.Resources>
                    <ResourceDictionary>
                        <Style
                            x:Key="Default"
                            BasedOn="{StaticResource DefaultChartStyle}"
                            TargetType="chart:CartesianChart" />

                        <Style
                            x:Key="Small"
                            BasedOn="{StaticResource DefaultChartStyle}"
                            TargetType="chart:CartesianChart">
                            <Setter Property="Visibility" Value="Collapsed" />
                        </Style>

                        <Style
                            x:Key="Medium"
                            BasedOn="{StaticResource DefaultChartStyle}"
                            TargetType="chart:CartesianChart" />
                    </ResourceDictionary>
                </chart:CartesianChart.Resources>
            </chart:CartesianChart>

            <Grid x:Name="UIRadialIndicator" Style="{StaticResource DefaultRadialIndicatorStyle}">
                <Grid.Resources>
                    <ResourceDictionary>
                        <Style
                            x:Key="Default"
                            BasedOn="{StaticResource DefaultRadialIndicatorStyle}"
                            TargetType="Grid" />

                        <Style
                            x:Key="Small"
                            BasedOn="{StaticResource DefaultRadialIndicatorStyle}"
                            TargetType="Grid">
                            <Setter Property="Visibility" Value="Visible" />
                        </Style>

                        <Style
                            x:Key="Medium"
                            BasedOn="{StaticResource DefaultRadialIndicatorStyle}"
                            TargetType="Grid" />
                    </ResourceDictionary>
                </Grid.Resources>

                <Ellipse
                    Width="80"
                    Height="80"
                    Stroke="{DynamicResource CardBackground}"
                    StrokeThickness="10" />
                <ui:ProgressRing
                    Width="80"
                    Height="80"
                    Foreground="#8767B5"
                    Progress="{Binding SelectedGpuDevice.LoadPercentage, Mode=OneWay}" />

                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Image
                        Width="20"
                        Height="20"
                        HorizontalAlignment="Center"
                        Source="{Binding GpuIconSource, Mode=OneWay}" />
                    <ui:TextBlock
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        d:Text="0%"
                        FontSize="17"
                        FontWeight="SemiBold"
                        Text="{Binding SelectedGpuDevice.PercentageDisplay, Mode=OneWay}" />
                </StackPanel>
            </Grid>
        </Grid>

        <Grid
            x:Name="UIPrivacyMessage"
            d:Visibility="Collapsed"
            Visibility="{Binding IsPrivacyMessageVisible, Mode=OneWay, Converter={StaticResource BoolToVisibility}}">

            <StackPanel
                Margin="15,10,15,0"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                h:MarginSetter.LastItemMargin="0"
                h:MarginSetter.Margin="0, 0, 0, 5">
                <TextBlock
                    Text="{x:Static r:Resources.PermissionNeeded}"
                    TextAlignment="Center"
                    TextTrimming="CharacterEllipsis" />

                <TextBlock
                    Opacity="0.8"
                    Text="{x:Static r:Resources.WidgetNeedsPermission}"
                    TextAlignment="Center"
                    TextWrapping="Wrap" />

                <ui:HyperlinkButton
                    Padding="11,5"
                    HorizontalAlignment="Center"
                    Command="{Binding RequestAccessCommand}"
                    Content="{x:Static r:Resources.AllowLabel}" />
            </StackPanel>

        </Grid>
    </Grid>

</c:Widget>
