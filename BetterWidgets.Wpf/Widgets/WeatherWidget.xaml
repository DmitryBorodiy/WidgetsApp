<c:Widget
    x:Class="BetterWidgets.Widgets.WeatherWidget"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:c="clr-namespace:BetterWidgets.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:h="clr-namespace:BetterWidgets.Helpers"
    xmlns:m="clr-namespace:BetterWidgets.Model.Weather"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:r="clr-namespace:BetterWidgets.Resources"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:vc="clr-namespace:BetterWidgets.ViewModel.Widgets.Components"
    xmlns:vm="clr-namespace:BetterWidgets.ViewModel.Widgets"
    x:Name="Root"
    Width="260"
    Height="260"
    MinWidth="120"
    MinHeight="110"
    d:DesignHeight="250"
    d:DesignWidth="260"
    AppearedCommand="{Binding LoadCommand}"
    AppearedCommandParameter="{Binding ElementName=Root}"
    CanShare="{Binding CanShare, Mode=OneWay}"
    Foreground="{Binding Foreground, Mode=OneWay}"
    IsHideTitleBar="True"
    IsLoading="{Binding IsLoading, Mode=OneWay}"
    IsTitleBarEnabled="True"
    PinnedCommand="{Binding PinnedCommand}"
    PinnedCommandParameter="{Binding ElementName=Root}"
    ShareCommand="{Binding ShareCommand}"
    ShareCommandParameter="{Binding ElementName=Root}"
    StateChangedCommand="{Binding ExecutionStateChangedCommand}"
    Style="{StaticResource DefaultWidgetStyle}"
    UnpinCommand="{Binding UnpinCommand}"
    mc:Ignorable="d">
    <c:Widget.DataContext>
        <vm:WeatherViewModel />
    </c:Widget.DataContext>
    <c:Widget.ContextMenu>
        <ContextMenu>
            <ui:MenuItem
                Command="{Binding LoadCommand}"
                CommandParameter="{Binding ElementName=Root}"
                Header="{x:Static r:Resources.Refresh}">
                <ui:MenuItem.Icon>
                    <ui:SymbolIcon Symbol="ArrowClockwise20" />
                </ui:MenuItem.Icon>
            </ui:MenuItem>
            <ui:MenuItem
                Command="{Binding LaunchSettingsCommand}"
                CommandParameter="{Binding ElementName=Root}"
                Header="{x:Static r:Resources.SettingsLabel}">
                <ui:MenuItem.Icon>
                    <ui:SymbolIcon Symbol="Settings20" />
                </ui:MenuItem.Icon>
            </ui:MenuItem>
            <ui:MenuItem Command="{Binding RequestFindDialogCommand}" Header="{x:Static r:Resources.FindPlace}">
                <ui:MenuItem.Icon>
                    <ui:SymbolIcon Symbol="Search20" />
                </ui:MenuItem.Icon>
            </ui:MenuItem>
            <ui:MenuItem
                Command="{Binding ShareCommand}"
                CommandParameter="{Binding ElementName=Root}"
                Header="{x:Static r:Resources.ShareLabel}">
                <ui:MenuItem.Icon>
                    <ui:SymbolIcon Symbol="Share20" />
                </ui:MenuItem.Icon>
            </ui:MenuItem>
            <Separator />
            <ui:MenuItem Command="{Binding UnpinCommand}" Header="{x:Static r:Resources.Close}">
                <ui:MenuItem.Icon>
                    <ui:SymbolIcon Symbol="Dismiss20" />
                </ui:MenuItem.Icon>
            </ui:MenuItem>
        </ContextMenu>
    </c:Widget.ContextMenu>
    <c:Widget.TitleBar>
        <c:WidgetTitleBar
            x:Name="TitleBarUI"
            Grid.Row="0"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Top"
            Background="Transparent"
            CloseCommand="{Binding CloseCommand}"
            IconVisibility="Collapsed"
            IsPinned="{Binding Widget.IsPinned, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
            TitleVisibility="Collapsed" />
    </c:Widget.TitleBar>

    <Grid x:Name="RootLayout">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Border
            Name="BackgroundLayer"
            Grid.RowSpan="3"
            Grid.ColumnSpan="2"
            d:Style="{StaticResource ClearDayWeatherBackgound}"
            Style="{Binding Background, Mode=OneWay}"
            Visibility="{Binding IsLiveBackground, Mode=OneWay, Converter={StaticResource BoolToVisibility}}" />

        <StackPanel
            Grid.Row="0"
            Grid.Column="0"
            Margin="15,13,15,0"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Top"
            IsHitTestVisible="False"
            Visibility="{Binding RootLayoutVisibility, Mode=OneWay}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <c:MarqueeTextBlock
                    Grid.Row="0"
                    Height="18"
                    d:Text="Sunny"
                    DurationSeconds="6"
                    FontSize="13"
                    Opacity="0.8"
                    Text="{Binding WeatherDay.Title, Mode=OneWay}" />

                <StackPanel Grid.Row="1" Orientation="Horizontal">
                    <ui:TextBlock
                        Grid.Row="1"
                        Grid.Column="0"
                        Width="Auto"
                        Margin="0,-11,0,-2"
                        HorizontalAlignment="Left"
                        d:Text="28"
                        FontSize="48"
                        FontWeight="Light"
                        Text="{Binding WeatherDay.Temperature, Mode=OneWay}" />
                    <Ellipse
                        Grid.Row="1"
                        Grid.Column="0"
                        Width="11"
                        Height="11"
                        Margin="3,8"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Top"
                        Stroke="{Binding Foreground, Mode=OneWay}"
                        StrokeThickness="2" />
                </StackPanel>
            </Grid>
        </StackPanel>

        <Image
            Grid.Row="0"
            Grid.Column="1"
            Width="47"
            Height="47"
            Margin="15"
            HorizontalAlignment="Right"
            VerticalAlignment="Top"
            d:Source="pack://application:,,,/Assets/WeatherWidget/UnitAssets/01d.png"
            IsHitTestVisible="False"
            Source="{Binding WeatherDay.IconSource, Mode=OneWay}"
            Visibility="{Binding RootLayoutVisibility, Mode=OneWay}" />

        <Grid
            x:Name="AdditionalInfoUI"
            Grid.Row="1"
            Grid.ColumnSpan="2"
            Margin="15,0,16,0"
            HorizontalAlignment="Stretch"
            Background="{x:Null}"
            IsHitTestVisible="False"
            Visibility="{Binding RootLayoutVisibility, Mode=OneWay}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <Grid HorizontalAlignment="Stretch">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <ui:SymbolIcon
                        Grid.Column="0"
                        Margin="0,1,0,0"
                        FontSize="15"
                        Symbol="ChevronUp20" />
                    <ui:TextBlock
                        Grid.Column="1"
                        Margin="6,0,0,0"
                        d:Text="30"
                        FontSize="14"
                        Text="{Binding WeatherDay.MaxTemperature, Mode=OneWay}" />
                    <Ellipse
                        Grid.Column="2"
                        Width="6"
                        Height="6"
                        Margin="3,5,0,0"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Stroke="{Binding Foreground, Mode=OneWay}"
                        StrokeThickness="1.2" />
                </Grid>
                <Grid Margin="0,5,0,0" HorizontalAlignment="Stretch">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <ui:SymbolIcon
                        Grid.Column="0"
                        Margin="0,-1,0,0"
                        FontSize="15"
                        Symbol="ChevronDown20" />
                    <ui:TextBlock
                        Grid.Column="1"
                        Margin="6,0,0,0"
                        d:Text="25"
                        FontSize="14"
                        Text="{Binding WeatherDay.MinTemperature, Mode=OneWay}" />
                    <Ellipse
                        Grid.Column="2"
                        Width="6"
                        Height="6"
                        Margin="3,5,0,0"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Stroke="{Binding Foreground, Mode=OneWay}"
                        StrokeThickness="1.2" />
                </Grid>
            </StackPanel>

            <StackPanel
                Grid.Row="1"
                Grid.Column="1"
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom">
                <Grid HorizontalAlignment="Right">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <ui:SymbolIcon
                        Grid.Column="0"
                        Filled="True"
                        FontSize="16"
                        Symbol="Drop20" />
                    <ui:TextBlock
                        Grid.Column="1"
                        Margin="5,0,0,1"
                        VerticalAlignment="Center"
                        d:Text="20%"
                        Text="{Binding WeatherDay.Humidity, Mode=OneWay}" />
                </Grid>
                <Grid Margin="0,4,0,0" HorizontalAlignment="Right">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <ui:SymbolIcon
                        Margin="2,0,0,0"
                        FontSize="16"
                        Symbol="WeatherDuststorm20" />
                    <ui:TextBlock
                        Grid.Column="1"
                        Margin="6,0,0,1"
                        d:Text="3 m/sec"
                        FontSize="14"
                        Text="{Binding WeatherDay.WindSpeed, Mode=OneWay}" />
                </Grid>
            </StackPanel>

            <VisualStateManager.VisualStateGroups>
                <VisualStateGroup>
                    <VisualState Name="InfoCollapsed" Storyboard="{StaticResource HideAnimation}" />
                    <VisualState Name="InfoVisible" Storyboard="{StaticResource ShowAnimation}" />
                </VisualStateGroup>
            </VisualStateManager.VisualStateGroups>
        </Grid>

        <Grid
            x:Name="DailyForecastUI"
            Grid.Row="2"
            Grid.ColumnSpan="2"
            Margin="1,5"
            HorizontalAlignment="Stretch"
            Background="{x:Null}"
            Visibility="{Binding RootLayoutVisibility, Mode=OneWay}">
            <ui:DynamicScrollViewer
                x:Name="ForecastScrollViewerUI"
                Margin="-10,0,0,0"
                HorizontalScrollBarVisibility="Hidden"
                MouseWheel="OnForecastMouseWheel"
                VerticalScrollBarVisibility="Disabled">
                <ui:ListView
                    ItemTemplate="{StaticResource WeatherDayItemTemplate}"
                    ItemsPanel="{StaticResource WeatherForecastItemsPanel}"
                    ItemsSource="{Binding Days, Mode=OneWay}"
                    ScrollViewer.CanContentScroll="False"
                    ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                    ScrollViewer.VerticalScrollBarVisibility="Disabled"
                    SelectedItem="{Binding WeatherDay, Mode=TwoWay}"
                    VirtualizingStackPanel.IsVirtualizing="False">
                    <d:ListView.ItemsSource>
                        <CompositeCollection>
                            <vc:WeatherDayView />
                            <vc:WeatherDayView />
                            <vc:WeatherDayView />
                            <vc:WeatherDayView />
                            <vc:WeatherDayView />
                        </CompositeCollection>
                    </d:ListView.ItemsSource>
                </ui:ListView>
            </ui:DynamicScrollViewer>

            <VisualStateManager.VisualStateGroups>
                <VisualStateGroup>
                    <VisualState Name="ForecastCollapsed" Storyboard="{StaticResource HideAnimation}" />
                    <VisualState Name="ForecastVisible" Storyboard="{StaticResource ShowAnimation}" />
                </VisualStateGroup>
            </VisualStateManager.VisualStateGroups>
        </Grid>

        <StackPanel
            Grid.RowSpan="3"
            Grid.ColumnSpan="2"
            MaxWidth="180"
            Margin="0,0,0,0"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            h:MarginSetter.LastItemMargin="0"
            h:MarginSetter.Margin="0, 0, 0, 9"
            Visibility="{Binding IsSetupNeeded, Mode=OneWay, Converter={StaticResource BoolToVisibility}}">
            <ui:TextBlock
                HorizontalAlignment="Center"
                Text="{x:Static r:Resources.ChooseLocation}"
                TextAlignment="Center"
                TextTrimming="CharacterEllipsis" />
            <ui:TextBlock
                HorizontalAlignment="Center"
                Opacity="0.8"
                Text="{x:Static r:Resources.ChooseLocationSubtitle}"
                TextAlignment="Center"
                TextWrapping="Wrap" />
            <ui:HyperlinkButton
                HorizontalAlignment="Center"
                Command="{Binding RequestFindDialogCommand}"
                Content="{x:Static r:Resources.ChooseLocation}" />
        </StackPanel>

    </Grid>

</c:Widget>
