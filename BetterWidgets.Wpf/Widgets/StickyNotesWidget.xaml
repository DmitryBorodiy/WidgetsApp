<c:Widget
    x:Class="BetterWidgets.Widgets.StickyNotesWidget"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:c="clr-namespace:BetterWidgets.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:doc="clr-namespace:BetterWidgets.Helpers.XamlDocs"
    xmlns:h="clr-namespace:BetterWidgets.Helpers"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:r="clr-namespace:BetterWidgets.Resources"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:vm="clr-namespace:BetterWidgets.ViewModel.Widgets"
    x:Name="Root"
    Width="250"
    Height="250"
    MinWidth="200"
    MinHeight="200"
    d:DesignHeight="300"
    d:DesignWidth="300"
    AppearedCommand="{Binding AppearedCommand}"
    AppearedCommandParameter="{Binding ElementName=Root}"
    CanShare="{Binding IsNoteSelected, Mode=OneWay}"
    IsLoading="{Binding IsLoading, Mode=OneWay}"
    IsTitleBarEnabled="True"
    PinnedCommand="{Binding PinnedCommand}"
    PinnedCommandParameter="{Binding ElementName=Root}"
    ShareCommand="{Binding ShareCommand}"
    SizeChangedCommand="{Binding ResizeCommand}"
    UnpinCommand="{Binding UnpinnedCommand}"
    mc:Ignorable="d">
    <c:Widget.DataContext>
        <vm:StickyNotesViewModel />
    </c:Widget.DataContext>
    <c:Widget.TitleBar>
        <c:WidgetTitleBar
            x:Name="UITitleBar"
            Title="{x:Static r:Resources.Notes}"
            Background="Transparent"
            Icon="/Assets/Notes/icon-48.png"
            IsPinned="{Binding ElementName=Root, Path=Topmost, Mode=TwoWay}">

            <c:WidgetTitleBar.Content>
                <StackPanel
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    Orientation="Horizontal">
                    <ui:Button
                        Margin="0,0,1,0"
                        Padding="7"
                        Command="{Binding CreateNoteCommand}"
                        IsEnabled="{Binding IsSignedIn, Mode=OneWay}"
                        Style="{StaticResource FlatButton}"
                        ToolTipService.ToolTip="{x:Static r:Resources.NewNote}">
                        <ui:Button.Icon>
                            <ui:SymbolIcon FontSize="15" Symbol="Add20" />
                        </ui:Button.Icon>
                    </ui:Button>
                </StackPanel>
            </c:WidgetTitleBar.Content>

        </c:WidgetTitleBar>
    </c:Widget.TitleBar>
    <c:Widget.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/Widgets/StickyNotesWidgetResources.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <Style
                x:Key="DefaultNotesCollectionStyle"
                BasedOn="{StaticResource {x:Type ui:ListView}}"
                TargetType="ui:ListView">
                <Setter Property="Margin" Value="-2,0" />
                <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Hidden" />
                <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled" />

                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Visible" />
                    </Trigger>
                </Style.Triggers>
            </Style>
        </ResourceDictionary>
    </c:Widget.Resources>
    <c:Widget.ContextMenu>
        <ContextMenu>
            <ui:MenuItem
                Command="{Binding RefreshCommand}"
                CommandParameter="{Binding ElementName=Root}"
                Header="{x:Static r:Resources.Refresh}">
                <ui:MenuItem.Icon>
                    <ui:SymbolIcon Symbol="ArrowClockwise20" />
                </ui:MenuItem.Icon>
            </ui:MenuItem>
            <Separator Visibility="{Binding IsNoteSelected, Mode=OneWay, Converter={StaticResource BoolToVisibility}}" />
            <ui:MenuItem
                Command="{Binding NotesCollectionMouseDownCommand}"
                Header="{x:Static r:Resources.Edit}"
                IsEnabled="{Binding IsSignedIn, Mode=OneWay}"
                Visibility="{Binding IsNoteSelected, Mode=OneWay, Converter={StaticResource BoolToVisibility}}">
                <ui:MenuItem.Icon>
                    <ui:SymbolIcon Symbol="Edit20" />
                </ui:MenuItem.Icon>
            </ui:MenuItem>
            <ui:MenuItem
                Command="{Binding SelectedNote.RequestDeleteCommand, Mode=OneWay}"
                Header="{x:Static r:Resources.DeleteLabel}"
                IsEnabled="{Binding IsSignedIn, Mode=OneWay}"
                Visibility="{Binding IsNoteSelected, Mode=OneWay, Converter={StaticResource BoolToVisibility}}">
                <ui:MenuItem.Icon>
                    <ui:SymbolIcon Symbol="Delete20" />
                </ui:MenuItem.Icon>
            </ui:MenuItem>
            <ui:MenuItem
                Command="{Binding ShareCommand}"
                Header="{x:Static r:Resources.ShareLabel}"
                Visibility="{Binding IsNoteSelected, Mode=OneWay, Converter={StaticResource BoolToVisibility}}">
                <ui:MenuItem.Icon>
                    <ui:SymbolIcon Symbol="Share20" />
                </ui:MenuItem.Icon>
            </ui:MenuItem>
            <Separator />
            <ui:MenuItem Command="{Binding LaunchSettingsCommand}" Header="{x:Static r:Resources.SettingsLabel}">
                <ui:MenuItem.Icon>
                    <ui:SymbolIcon Symbol="Settings20" />
                </ui:MenuItem.Icon>
            </ui:MenuItem>
        </ContextMenu>
    </c:Widget.ContextMenu>

    <Grid
        x:Name="RootLayout"
        Margin="{Binding RootMargin, Mode=OneWay}"
        d:Margin="13">

        <ui:ListView
            x:Name="UINotesCollection"
            ItemTemplate="{StaticResource StickyNoteItemTemplate}"
            ItemsPanel="{StaticResource StickyNotesItemsPanel}"
            ItemsSource="{Binding Notes, Mode=OneWay}"
            SelectedItem="{Binding SelectedNote, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
            Style="{StaticResource DefaultNotesCollectionStyle}"
            Visibility="{Binding IsSignedIn, Mode=OneWay, Converter={StaticResource BoolToVisibility}}">

            <i:Interaction.Triggers>
                <i:EventTrigger EventName="KeyDown">
                    <i:InvokeCommandAction Command="{Binding NotesCollectionKeyDownCommand}" PassEventArgsToCommand="True" />
                </i:EventTrigger>
                <i:EventTrigger EventName="MouseLeftButtonUp">
                    <i:InvokeCommandAction Command="{Binding NotesCollectionMouseDownCommand}" PassEventArgsToCommand="True" />
                </i:EventTrigger>
            </i:Interaction.Triggers>

        </ui:ListView>

        <!--#region Design-->
        <d:StackPanel h:MarginSetter.Margin="0, 0, 0, 5">
            <ui:Card
                MaxHeight="110"
                Padding="0"
                VerticalAlignment="Top"
                ClipToBounds="True">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition />
                    </Grid.RowDefinitions>

                    <Border
                        Grid.Row="0"
                        Height="3"
                        Background="LightGreen"
                        CornerRadius="3, 3, 0, 0" />

                    <Grid Grid.Row="1" Margin="8,6,8,3">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <ui:TextBlock
                            Grid.Row="0"
                            Grid.Column="0"
                            FontSize="14"
                            Text="Lorem ipsum" />

                        <ui:TextBlock
                            Grid.Row="0"
                            Grid.Column="1"
                            FontSize="11"
                            Opacity="0.8"
                            Text="6/5/2025" />

                        <ui:TextBlock
                            Grid.Row="1"
                            Grid.ColumnSpan="2"
                            Margin="0,2,0,0"
                            FontSize="12"
                            Opacity="0.8"
                            Text="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent sem erat, rhoncus in bibendum consectetur, ultricies scelerisque tortor. Integer justo neque, vehicula nec rhoncus a, ornare et ipsum."
                            TextTrimming="CharacterEllipsis"
                            TextWrapping="Wrap" />
                    </Grid>
                </Grid>
            </ui:Card>
            <ui:Card
                MaxHeight="110"
                Padding="0"
                VerticalAlignment="Top"
                ClipToBounds="True">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition />
                    </Grid.RowDefinitions>

                    <Border
                        Grid.Row="0"
                        Height="3"
                        Background="LightBlue"
                        CornerRadius="3, 3, 0, 0" />

                    <Grid Grid.Row="1" Margin="8,6,8,3">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <ui:TextBlock
                            Grid.Row="0"
                            Grid.Column="0"
                            FontSize="14"
                            Text="Lorem ipsum" />

                        <ui:TextBlock
                            Grid.Row="0"
                            Grid.Column="1"
                            FontSize="11"
                            Opacity="0.8"
                            Text="6/5/2025" />

                        <ui:TextBlock
                            Grid.Row="1"
                            Grid.ColumnSpan="2"
                            Margin="0,2,0,0"
                            FontSize="12"
                            Opacity="0.8"
                            Text="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent sem erat, rhoncus in bibendum consectetur, ultricies scelerisque tortor. Integer justo neque, vehicula nec rhoncus a, ornare et ipsum."
                            TextTrimming="CharacterEllipsis"
                            TextWrapping="Wrap" />
                    </Grid>
                </Grid>
            </ui:Card>
            <ui:Card
                MaxHeight="110"
                Padding="0"
                VerticalAlignment="Top"
                ClipToBounds="True">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition />
                    </Grid.RowDefinitions>

                    <Border
                        Grid.Row="0"
                        Height="3"
                        Background="LightYellow"
                        CornerRadius="3, 3, 0, 0" />

                    <Grid Grid.Row="1" Margin="8,6,8,3">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <ui:TextBlock
                            Grid.Row="0"
                            Grid.Column="0"
                            FontSize="14"
                            Text="Lorem ipsum" />

                        <ui:TextBlock
                            Grid.Row="0"
                            Grid.Column="1"
                            FontSize="11"
                            Opacity="0.8"
                            Text="6/5/2025" />

                        <ui:TextBlock
                            Grid.Row="1"
                            Grid.ColumnSpan="2"
                            Margin="0,2,0,0"
                            FontSize="12"
                            Opacity="0.8"
                            Text="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent sem erat, rhoncus in bibendum consectetur, ultricies scelerisque tortor. Integer justo neque, vehicula nec rhoncus a, ornare et ipsum."
                            TextTrimming="CharacterEllipsis"
                            TextWrapping="Wrap" />
                    </Grid>
                </Grid>
            </ui:Card>
        </d:StackPanel>
        <!--#endregion Design End-->

        <StackPanel
            Grid.RowSpan="3"
            Grid.ColumnSpan="3"
            MaxWidth="180"
            Margin="0,0,0,30"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            d:Visibility="Collapsed"
            h:MarginSetter.LastItemMargin="0"
            h:MarginSetter.Margin="0, 0, 0, 6"
            Visibility="{Binding IsSignedIn, Mode=OneWay, Converter={StaticResource BoolToVisibilityInvert}}">
            <ui:TextBlock
                FontWeight="SemiBold"
                Text="{x:Static r:Resources.SignInLabel}"
                TextAlignment="Center"
                TextTrimming="CharacterEllipsis" />
            <ui:TextBlock
                FontSize="12"
                Opacity="0.8"
                Text="{x:Static r:Resources.SignInMessage}"
                TextAlignment="Center"
                TextWrapping="Wrap" />
        </StackPanel>

        <StackPanel
            x:Name="UIEmpty"
            Grid.RowSpan="2"
            Grid.ColumnSpan="2"
            Margin="15,0,15,15"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            h:MarginSetter.LastItemMargin="0"
            h:MarginSetter.Margin="0, 0, 0, 5"
            Visibility="{Binding IsEmpty, Mode=OneWay, Converter={StaticResource BoolToVisibility}}">
            <ui:TextBlock
                HorizontalAlignment="Center"
                Text="{x:Static r:Resources.NothingHere}"
                TextAlignment="Center" />
            <ui:TextBlock
                HorizontalAlignment="Stretch"
                Opacity="0.8"
                Text="{x:Static r:Resources.NotesEmptyMessage}"
                TextAlignment="Center"
                TextWrapping="Wrap" />
            <ui:HyperlinkButton
                HorizontalAlignment="Center"
                Command="{Binding CreateNoteCommand}"
                CommandParameter="{Binding ElementName=Root}"
                Content="{x:Static r:Resources.NewNote}" />
        </StackPanel>
    </Grid>

</c:Widget>
